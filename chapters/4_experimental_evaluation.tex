\section{Bază de date filme}
În cadrul prezentei diserații a fost folosită ca bază de date pentru evaluarea experimentală baza oferita de grouplens \hyperlink{movielens}{[22]}. Aceștia pun la dispoziție mai multe seturi de date printre care:
\begin{enumerate}
	\item \textbf{MovieLens 20M Dataset}: conține 20 milioane de ratinguri oferite de 138 000 de utilizatori peste 27 000 de filme;
	\item \textbf{MovieLens 10M Dataset}: conține 10 milioane de ratinguri oferite de 72 000 de utilizatori peste 10 000 de filme;
	\item \textbf{MovieLens 1M Dataset}: conține 1 milion de ratinguri oferite de 6 000 de utilizatori peste 4 000 de filme.
\end{enumerate}

În evaluarea curentă a fost folosită cea mai recentă versiune de bază de date, actualizată la 9/2018, de dimensiune mică și anume \textit{ml-latest-small}. Această bază de date conține 100 000 de ratinguri și 3 600 de taguri aplicate peste 9 000 de filme de 600 de utilizatori. Această bază de date este un subset dintr-o bază de date cu 27 de milioane de ratinguri și 1 milion de taguri, aplicate peste 58 000 de filme de 280 000 de utilizatori.

Fiecare utilizator din \textit{ml-latest-small} a acordat ratinguri pentru cel puțin 20 de filme. Baza de date nu conține informații demografice, fiecare utilizator fiind reprezentat doar de un id.

Structura fișierelor din baza de date:
\begin{itemize}
	\item \textbf{ratings.csv}: fiecare linie din acest fișier reprezintă un rating dat de un utilizator unui film, fișierul având formatul $userId, movieId, rating, timestamp$, unde $timestamp$ reprezintă momentul de timp când a fost acordat ratingul. Fiecare rating este cuprins între 0 și 5, iar între ratinguri este unpas de 0.5;
	\item \textbf{movies.csv}: conține metadate despre filme precum titlul și genul. Formatul fișierului este următorul: $movieId, title, genres$. Titlul conține și anul de apariție a filmului sub forma \textit{Titlu (an)}. Genul poate fi unul sau mai multe dintre următoarele: \textit{Action, Adventure, Animation, Children's, Comedy, Crime, Documentary, Drama, Fantasy, Film-Noir, Horror, Musical, Mystery Romance, Sci-Fi, Thriller, War Western, (no genres listed)}.
	\item \textbf{links.csv}: conține referințele către site-urile movielens, imdb și themoviedb sub următorul format: $movieId,imdbId,tmdbId$.
	\item \textbf{tags.csv}: fiecare linie conține un tag aplicat de un utilizator unui film, fișierul având următorul format $userId,movieId,tag,timestamp$. Fiecare tag este reprezentat de un cuvânt sau de o scurtă frază.
\end{itemize}

\section{Bază de date postere}
În ceea ce privește baza de date pentru postere, aceasta a fost construită în cadrul dezvoltării prezentei lucrări cu ajutorul a două elemente: fișierul de \textit{links} din setul de date \textit{ml-latest-small} și cu API-ul pus la dispoziție de către platforma \textbf{themoviedb.org} \hyperlink{themoviedb}{[24]}.

Procesul de construcție a acestui set de postere pentru filme poate fi rezumat pe pași după cum urmează:
\begin{enumerate}
	\item \textbf{Pasul 1}: extragerea id-urilor filmelor aferente platformei themoviedb.org;
	\item \textbf{Pasul 2}: pentru fiecare film se face un request către API pentru a lua lista de postere pentru filmul curent;
	\item \textbf{Pasul 3}: având adresele posterelor pentru filmul curent, se descarcă și se salvează posterele la dimensiunea originală într-un folder specific filmului.
\end{enumerate}
Din punct de vedere al implementării putem menționa funcțiile:
\begin{lstlisting}[language=Python, caption=Construcția setul de date cu postere]
def get_tmdb_posters(tmdb_api_key, max_movie_posters=10):
    # pasul 1    
    tmdb_movies_id = get_tmdb_ids()
    # pasul 2 - 3
    download_images(tmdb_api_key, tmdb_movies_id, max_movie_posters)

# unde download_images are urmatoarea definitie:
def download_images(tmdb_api_key, tmdb_movies_id, max_movie_posters=10):
\end{lstlisting}
unde:
\begin{itemize}
	\item \textbf{tmdb\_api\_key} este api key-ul unic asociat unui cont pe platforma themoviedb.org care a solicitat acces la API-ul platformei;
	\item \textbf{max\_movie\_posters} definește care este numărul maxim de postere care va fi descărcat pentru un film. Numărul de postere descărcate poate fi mai mic în cazul în care nu sunt cel puțin max\_movie\_posters.
\end{itemize}

\begin{figure}[!tbp]
  \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=9cm,height=5cm,keepaspectratio]{img_4_1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=9cm,height=5cm,keepaspectratio]{img_4_2}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=9cm,height=5cm,keepaspectratio]{img_4_3}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=9cm,height=5cm,keepaspectratio]{img_4_4}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=9cm,height=5cm,keepaspectratio]{img_4_5}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=9cm,height=5cm,keepaspectratio]{img_4_6}
  \end{subfigure}
  \caption[Exemple de postere]{Exemplu de postere pentru filmul Paddington 2.}
\end{figure}

\section{Rezultate clusterizare postere}

\subsection{Sanity check}
Pentru testarea validității clasterelor un test de sanity check în care s-au luat opt filme și s-a încercat clasificarea lor în șapte clastere folosind caracteristicile extrase din rețelele preantrenate VGG16, VGG19, InceptionV3, ResNet50 și NASNet, clasterele create cu kNN iar evaluarea este făcută atât vizual cât și prin urmărirea evoluției metricii silhouette de la 2 la 7 clastere. Posterele de input pentru sanity check sunt prezentate în figura 4.2.
\begin{figure}[!tbp]
  \centering
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_4_7}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_4_8}
  \end{subfigure}
    \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_4_9}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_4_10}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_4_11}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_4_12}
  \end{subfigure}
    \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_4_13}
  \end{subfigure}
    \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_4_14}
  \end{subfigure}
      \hfill
  \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{img_4_15}
  \end{subfigure}
  \caption[Postere input sanity check]{Posterele de input pentru sanity check.}
\end{figure}

Din punct de vedere al metricii de evaluare silhouette rezultatele se prezintă după cum urmează în figura 4.3.
\begin{figure}[!h]
	\centering
	\includegraphics[max width=12cm,max height=12cm,keepaspectratio]{img_4_16}
	\caption[Silhouette score pentru clasterele din sanity check]{Silhouette score pentru clasterele din sanity check.}
\end{figure} 
După cum se oberservă reţelele InceptionV3 şi NASNet pare a ieşi
mereu mai bine decât celelalte, cu un avantaj al reţelei InceptionV3. Această observaţie
fiind valabile pentru toate clasterele de la 2 la 7. Toate celelalte reţele sunt destul de
apropiate în rezultate în special începând cu clasterul 3 şi mai puţin la clasterul 2. Toate
celelalte reţele, cu excepţia ResNet50 au fluctuaţii. ResNet50 este singura care păstrează
în mod continuu trendul ascendent de la clasterul 2 până la clasterul 7.

Din punct de vedere vizual, rezultatatele clasterelor sunt prezentate în figurile 4.4 - 4.8.
\begin{figure}[!tbp]
  \centering
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_vgg16_c1}
    \caption{claster 1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_vgg16_c2}
    \caption{claster 2}
  \end{subfigure}
   \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_vgg16_c3}
    \caption{claster 3}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_vgg16_c4}
    \caption{claster 4}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_vgg16_c5}
    \caption{claster 5}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_vgg16_c6}
    \caption{claster 6}
  \end{subfigure}
    \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_vgg16_c7}
    \caption{claster 7}
  \end{subfigure}
  \caption[Rezultate sanity check pentru rețeaua VGG16]{Rezultate sanity check pentru rețeaua VGG16}
\end{figure}

\begin{figure}[!tbp]
  \centering
  \begin{subfigure}[b]{0.50\textwidth}
    \includegraphics[width=\textwidth]{img_vgg19_c1}
    \caption{claster 1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.50\textwidth}
    \includegraphics[width=\textwidth]{img_vgg19_c2}
    \caption{claster 2}
  \end{subfigure}
   \hfill
  \begin{subfigure}[b]{0.50\textwidth}
    \includegraphics[width=\textwidth]{img_vgg19_c3}
    \caption{claster 3}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.50\textwidth}
    \includegraphics[width=\textwidth]{img_vgg19_c4}
    \caption{claster 4}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.50\textwidth}
    \includegraphics[width=\textwidth]{img_vgg19_c5}
    \caption{claster 5}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.50\textwidth}
    \includegraphics[width=\textwidth]{img_vgg19_c6}
    \caption{claster 6}
  \end{subfigure}
    \hfill
  \begin{subfigure}[b]{0.50\textwidth}
    \includegraphics[width=\textwidth]{img_vgg19_c7}
    \caption{claster 7}
  \end{subfigure}
  \caption[Rezultate sanity check pentru rețeaua VGG19]{Rezultate sanity check pentru rețeaua VGG19}
\end{figure}

\begin{figure}[!tbp]
  \centering
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_inceptionv3_c1}
    \caption{claster 1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_inceptionv3_c2}
    \caption{claster 2}
  \end{subfigure}
   \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_inceptionv3_c3}
    \caption{claster 3}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_inceptionv3_c4}
    \caption{claster 4}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_inceptionv3_c5}
    \caption{claster 5}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_inceptionv3_c6}
    \caption{claster 6}
  \end{subfigure}
    \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_inceptionv3_c7}
    \caption{claster 7}
  \end{subfigure}
  \caption[Rezultate sanity check pentru rețeaua InceptionV3]{Rezultate sanity check pentru rețeaua InceptionV3}
\end{figure}

\begin{figure}[!tbp]
  \centering
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_resnet50_c1}
    \caption{claster 1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_resnet50_c2}
    \caption{claster 2}
  \end{subfigure}
   \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_resnet50_c3}
    \caption{claster 3}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_resnet50_c4}
    \caption{claster 4}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_resnet50_c5}
    \caption{claster 5}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_resnet50_c6}
    \caption{claster 6}
  \end{subfigure}
    \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{img_resnet50_c7}
    \caption{claster 7}
  \end{subfigure}
  \caption[Rezultate sanity check pentru rețeaua ResNet50]{Rezultate sanity check pentru rețeaua ResNet50}
\end{figure}

\begin{figure}[!tbp]
  \centering
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_nasnet_c1}
    \caption{claster 1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_nasnet_c2}
    \caption{claster 2}
  \end{subfigure}
   \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_nasnet_c3}
    \caption{claster 3}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_nasnet_c4}
    \caption{claster 4}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_nasnet_c5}
    \caption{claster 5}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_nasnet_c6}
    \caption{claster 6}
  \end{subfigure}
    \hfill
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{img_nasnet_c7}
    \caption{claster 7}
  \end{subfigure}
  \caption[Rezultate sanity check pentru rețeaua NASNet]{Rezultate sanity check pentru rețeaua NASNet}
\end{figure}

După cum se observă, din punct de vedere vizual doar rețeaua ResNet50 reușește să treacă acest sanity check clasificând sașe filme în șase clastere diferite, iar două filme în același claster. Din punct de vedere vizual posterele celor două filme clasificate în același cluster sunt destul de similare având în prim plan mai multe persoane, predominant începând cu partea de jos a posterelor, iar in partea de sus fiind conținut alb, în general, cu text.

Observăm că deși InceptionV3 și NASNet aveau scoruri mai mari pe coeficientul silhouette, rețeaua ResNet50 are rezultate vizuale mai bune pe sanity check. De remarcat corelația dintre faptul că rețeaua ResNet50 este singura a cărui coeficient silhouette creștea de la un claster la altul, ceea ce înseamnă că acele clastere deveneau din ce în ce mai bune pe măsură ce ne apropiam de numărul de clastere din realitate.

\subsection{Rezultate generale}
Pentru evaluarea clasterelor pe toate pe toate posterele filmelor, aproximativ 9 000, au fost eliminate din evaluare rețelele VGG16 și NASNet în baza rezultatelor prezentate în tabelul 3.1, în cazul rețelei VGG16 și a costului de memorie și timp de execuție din timpul experimentelor, în cazul rețelei NASNet.
\begin{figure}[!h]
	\centering
	\includegraphics[max width=12cm,max height=12cm,keepaspectratio]{img_4_17}
	\caption[Scorul silhouette pe setul de date de postere]{Scorul silhouette pe setul de date de postere.}
\end{figure} 
Se observă că rețeaua InceptionV3 are scorurile pentru toate clasterele de la 2 la 20 pozitive. Rețelele ResNet50 și VGG19 sunt negative, însă apropiate de 0 cu un avantaj de scoruri mai bune pentru rețeaua ResNet50.

\section{Rezultate sistem de recomandare}
În continuare vom studia rezultatele obținute de metricile de evaluare \textbf{precizie@k} și \textbf{acuratețe} pe timp de antrenare în epoci, pe metadate folosite în antrenarea modelului și pe tipuri de rețele preantrenate cu care au fost generate clasterele posterelor. Toate mențiunile către parametrii optimi pentru o anumite configurație se referă la parametrii prezentați în tabelele 3.1 și 3.2.

Rezultatele metricii de acuratețe sunt prezentate în figura 4.10. Aceste rezultate sun obținute utilizând parametrii optimi din tabelul 3.1. Reamintim că toate clasterele folosite pentru obținerea parametrilor optimi din din acest tabel au fost create folosind rețeaua VGG19.
\begin{figure}[!h]
	\centering
	\includegraphics[max width=12cm,max height=12cm,keepaspectratio]{img_4_18}
	\caption[Comparație acuratețea modelului cu parametrii optimi pe tipuri de metadate]{Comparație acuratețea modelului cu parametrii optimi pe tipuri de metadate.}
\end{figure}
Principalele concluzii pe care e putem trage pe baza acestui grafic sunt următoarele:
\begin{itemize}
	\item modelul fără metadate are un start mai bun decât decât modelul cu genuri sau modelul cu genuri și cu clastere, însă acesta nu urcă prea mult pe durata perioadei de antrenare, astfel ajungând să aibă cel mai slab rezultat dintre toate cele patru variante de model testate;
	\item modelul cu metadatele de genuri are un start destul de slab, fiind mai bun doar de modelul în care se folosesc atât genurile cât și clasterele, însă, până la final, acest model obține un rezultat bun și apropiat de rezultatul modelului cu genuri și clastere. O altă mențiune importantă ar fi că acest model are cea mai mare durată de antrenare față de toate celelalte modele;
	\item modelul cu metadatele de clastere are cel mai bun start și în același timp cea mai scurtă perioadă de antrenare pentru a obține cel mai optim rezultat dintre toate modelele testate. Acuratețea obținută de acest model este peste acurateșea obținută de modelul fără metadate dar sub cea obținută de modelul cu genuri însă destul de apropiată de aceasta;
	\item cel mai bun rezultat din acest experiment este obținut de modelul în care se folosesc atât metadatele de genuri cât și cele de clastere. Modelul are cel mai slab start însă cel mai bun rezultat final. Observăm că modul în care este obținut rezultatul este o combinație a avantajelor modelelor cu metadate de genuri și clastere. Pe de-o parte, acuratețea crește semnificativ față de modelul fără metadate și este apropiată de acuratețea modelului cu genuri. Pe de alta parte timpul de necesar obținerii acelui rezultat optim este mai scăzut decât la modelul cu genuri, timp influențat de metadatele de clastere.
\end{itemize}
Concluzia principală a acestui experiment este că un model ce conține genuri și clastere are o performanță de până la $1\%$ în plus față de modelul fără metadate și mai mare față de oricare alt model, iar timpul necesar pentru obținerea acestei performanțe este mai mic în comparație cu cel mai apropiat model din punct de vedere al metricii evaluate.

Pentru a avea o imagine mai completă de cum se pot comporta aceste modele în timp am eliminat parametrul optimi găsit pe numărul de epoci și l-am setat pentru fiecare model la un număr de 300 de epoci. Iar după cum se observă în figura 4.11 toate modele după punctul optim în care ating performanța maximă încep să scadă. Modelele fără metadate, cu metadatele de genuri și cu metadatele de clastere au o scădere destul de lină în timp, pe când scăderea este mai acelărată în cazul modelului ce folosește metadatele de clastere față de celelalte modele. 
Acest al doilea grafic conturează și mai bine o concluzie pe care o putem trage despre modelul cu clastere și anume: acesta atinge performanța maximă foarte repede din punct de vedere al timpului de execuție în comparație cu oricare al model testat în cadrul acestei lucrări, iar din acel moment în care a fost obținută performanța maximă nu mai este recomandată prelungirea procesului de antrenare scăderea care va urma după punctul maxim va fi foarte acelărată.
\begin{figure}[!h]
	\centering
	\includegraphics[max width=12cm,max height=12cm,keepaspectratio]{img_4_19}
	\caption[Comparație acuratețea modelului cu parametrii optimi pe tipuri de metadate cu număr setat de epoci]{Comparație acuratețea modelului cu parametrii optimi pe tipuri de metadate cu număr setat de epoci.}
\end{figure}